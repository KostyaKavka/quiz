const inquirer = require('inquirer');
const Model = require('./Model');

class View {
  topics = ['Кошки и собаки', 'Пятница', 'Общие вопросы'];

  quizResults = [];

  points = 0;

  async show() {
    inquirer
      .prompt([
        {
          name: 'label',
          message: `
        
░░░░░░░░░░░░░░░░░░░░░░░░░██████╗░██╗░░░██╗██╗███████╗░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░██╔═══██╗██║░░░██║██║╚════██║░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░██║██╗██║██║░░░██║██║░░███╔═╝░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░╚██████╔╝██║░░░██║██║██╔══╝░░░░░░░░░░░░░░░░░░░░░░░
██╗██╗██╗██╗██╗██╗██╗██╗░╚═██╔═╝░╚██████╔╝██║███████╗██╗██╗██╗██╗██╗██╗██╗
╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝░░░╚═╝░░░░╚═════╝░╚═╝╚══════╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝

░█████╗░████████╗░░░░░░███╗░░░███╗░█████╗░██╗░░░░░██╗░░░██╗██╗███╗░░██╗██╗
██╔══██╗╚══██╔══╝░░░░░░████╗░████║██╔══██╗██║░░░░░██║░░░██║██║████╗░██║██║
██║░░██║░░░██║░░░░░░░░░██╔████╔██║███████║██║░░░░░╚██╗░██╔╝██║██╔██╗██║██║
██║░░██║░░░██║░░░░░░░░░██║╚██╔╝██║██╔══██║██║░░░░░░╚████╔╝░██║██║╚████║██║
╚█████╔╝░░░██║░░░░░░░░░██║░╚═╝░██║██║░░██║███████╗░░╚██╔╝░░██║██║░╚███║██║
░╚════╝░░░░╚═╝░░░░░░░░░╚═╝░░░░░╚═╝╚═╝░░╚═╝╚══════╝░░░╚═╝░░░╚═╝╚═╝░░╚══╝╚═╝

░█████╗░███╗░░██╗██████╗░░░░░░░░░░░░░░░██████╗░██╗███████╗██████╗░░█████╗░
██╔══██╗████╗░██║██╔══██╗░░░░░░░░░░░░░░██╔══██╗██║██╔════╝██╔══██╗██╔══██╗
███████║██╔██╗██║██║░░██║░░░░░░░░░░░░░░██████╔╝██║█████╗░░██████╔╝██║░░██║
██╔══██║██║╚████║██║░░██║░░░░░░░░░░░░░░██╔═══╝░██║██╔══╝░░██╔══██╗██║░░██║
██║░░██║██║░╚███║██████╔╝░░░░░░░░░░░░░░██║░░░░░██║███████╗██║░░██║╚█████╔╝
╚═╝░░╚═╝╚═╝░░╚══╝╚═════╝░░░░░░░░░░░░░░░╚═╝░░░░░╚═╝╚══════╝╚═╝░░╚═╝░╚════╝░

░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗██╗
╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝╚═╝
        `,
        },
        { type: 'input', name: 'username', message: 'Введи имя:' },
        {
          type: 'rawlist',
          name: 'topic',
          message: 'Выберите тему:',
          choices: this.topics,
        },
      ])
      .then(async (answers) => {
        const selectedTopic = this.topics.indexOf(answers.topic);
        const data = await new Model(selectedTopic).readFiles();
        const questionsAndAnswers = data.map((item, index) => ({
          type: 'input',
          name: `${item.answer}_${index}`,
          message: `${item.question}\n`,
        }));

        this.quizResults = await inquirer.prompt(questionsAndAnswers);

        // eslint-disable-next-line no-restricted-syntax
        for (const key in this.quizResults) {
          if (this.quizResults[key] === key.slice(0, key.indexOf('_'))) {
            this.points += 10;
          }
        }

        const percentageCorrect = (this.points / 70) * 100;

        console.log(
          `\n${answers.username}, вы правильно ответили на ${Math.floor(
            percentageCorrect
          )}% вопросов.`
        );
      });
  }
}

module.exports = View;
